(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{109:function(t,e,n){"use strict";var r=n(263),i=n(48),a=i.baseUrl,o=new r.default({baseUrl:a});function p(){return o.makeQuery("/api/resource/?parent={id}",{id:i.pointsGroupId},{})}function s(t){return o.makeQuery("/api/resource/{id}/geojson",{id:t},{})}n.d(e,"b",(function(){return p})),n.d(e,"a",(function(){return s}))},112:function(t,e,n){"use strict";var r=n(107),i=n.n(r),a=n(47);function o(t){var e=/(\d{4})/.exec(t);if(e)return Number(e[0])}var p=n(67);n.d(e,"a",(function(){return d}));var s,c=(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=function(){return(u=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},l=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var a=arguments[e],o=0,p=a.length;o<p;o++,i++)r[i]=a[o];return r},d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.oldNgwMvtApi=!0,e.filterIdField="fid",e}return c(e,t),e.prototype.addLayers=function(t,e){return this._createTimeLayers(t,e)},e.prototype.getFillColor=function(t){return this._getFillColor(t)},e.prototype.createPopupContent=function(t){if(t&&t.status&&t.status<6){return this._createPropBlock([],t)}},e.prototype._createTimeLayers=function(t,e){var n=this.groupLayer;if(n){var r={"fill-opacity":n.opacity,"fill-opacity-transition":{duration:0},"fill-color":this._getFillColor()},i=u(u({},r),{"fill-color":this._getFillColor({darken:.5})}),a=e;return[this.app.webMap.addLayer("MVT",{url:t,id:e,name:e,paint:r,selectedPaint:i,selectable:!0,type:"fill",nativePaint:!0,labelField:"name",sourceLayer:a})]}return[]},e.prototype._getFillColor=function(t){void 0===t&&(t={});var e=this.app.options,n=e.lineColorLegend,r=e.lineColor;if(r&&n){n.forEach((function(t){t[3].forEach((function(e){var n=r.find((function(t){return t[0]===e}));n&&(n[1]=t[1])}))}));var a=r.reduce((function(e,n){var r=n[0],a=n[1],o=i()(a);return r&&e.push(r),t.darken&&(o=o.darken(t.darken)),e.push(o.hex()),e}),[]);return["match",["get","status"]].concat(a)}},e.prototype._formatDateStr=function(t){return t.split("-").reverse().join(".")},e.prototype._createPropElement=function(t,e){var n=document.createElement("div");return n.className="popup__propertyblock",n.innerHTML='<div class="popup__property--value'+(e?" "+e:"")+'" >'+t+"</div >",n},e.prototype._findPrincipalities01=function(t,e){return(this.app.options.principalities01||[]).find((function(n){var r=o(n.upperdat),i=o(n.lwdate);return!(!r||!i)&&(n.fid===t&&e<=r&&e>=i)}))},e.prototype._findPrincipalities02=function(t,e){return(this.app.options.principalities02||[]).find((function(n){var r=o(n.years_to),i=o(n.years_from);return!(!r||!i)&&(t===n.fid&&e<=r&&e>=i)}))},e.prototype._createPropBlock=function(t,e,n){var r=this;void 0===n&&(n="name");var i=document.createElement("div"),o=l(t),p=u({},e);"principalities"===this.app.getTimeStop(this.app.timeMap.currentYear)&&this._addPrincipalitiesFields(o,p),p[n]&&i.appendChild(this._createPropElement("<h2>"+p[n]+'\n            <a class="feature-link">&#x1f517;</a>\n          </h2>',"prop header")),o.forEach((function(t){var e=p[t.field];if(e){var n=document.createElement("div");if(n.className="popup__propertyblock",n.innerHTML="",e){var a=t.getHtml?t.getHtml(e,p):r._createPropElement(e,"");i.appendChild(a)}}})),e.status&&(i.innerHTML+=this._createPropStatusHtml(e));var s=i.getElementsByClassName("feature-link")[0];return s&&s.addEventListener("click",(function(){var t=document.location.origin+document.location.pathname;t+="?year="+r.app.timeMap.currentYear+"&id="+e.fid,r.app.urlParams.set("id",String(e.fid)),Object(a.a)(t)})),this._addPropShowDateClickEvent(i),i},e.prototype._addPrincipalitiesFields=function(t,e){var n=this,r=function(n,r){t.push(u({name:r.field},r)),e[r.field]=n},i=e.fid;if(i){var a=this._findPrincipalities01(i,this.app.timeMap.currentYear),o=this._findPrincipalities02(i,this.app.timeMap.currentYear);a&&(e.desc_link=a.desc_link,r(a.name,{field:"name_prince",getHtml:function(t,e){return n._createPropElement('<a href="'+e.desc_link+'" target="_blank">'+t+"</a>","")}})),o&&r(o.ruler,{field:"ruler",getHtml:function(t,e){return n._createPropElement('Правитель: <a href="'+e.desc_link+'" target="_blank">'+t+"</a>","")}})}},e.prototype._createPropStatusHtml=function(t){var e="",n=this.app.options.statusAliases&&this.app.options.statusAliases[t.status];if(n&&(e+='\n              <div class="popup__property--value status"><p>'+n+"</p></div>\n            "),t.status>0&&t.status<6){var r=this._formatDateStr(t.lwdate),i=this._formatDateStr(t.updtrl||t.upperdat);r&&i&&(e+='\n              <div class="popup__property--value dates">\n                <span>\n                  <span class="show-date">'+r+'</span> -\n                  <span class="show-date">'+i+"</span>\n                </span>\n              </div>\n            ")}return t.Area&&(e+='\n              <div class="popup__property--value area">\n                <span>\n                  '+Object(a.b)(t.Area/1e6)+"\n                </span>\n              </div>\n            "),e},e.prototype._addPropShowDateClickEvent=function(t){for(var e=this,n=t.querySelectorAll(".show-date"),r=function(t){var r=n[t];r.addEventListener("click",(function(){var t=o(r.innerHTML);t&&(e.app.timeMap.updateByYear(t),e.app.slider&&e.app.slider._slider&&e.app.slider._slider.set(t))}))},i=0;i<n.length;i++)r(i)},e}(p.a)},145:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=new(n(269).default)},262:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(144);function i(t){r&&setTimeout((function(){t(r)}))}},270:function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var r=n(278),i=n(30),a=n(47),o=n(109),p=function(){function t(t){this.app=t,this.opacity=1,this.simplification=8,this._markers=[],this._pointsConfig=[]}return t.prototype.setPoints=function(t){this._pointsConfig=this._processPointsMeta(t);var e=this._getPointIdByYear(this.app.timeMap.currentYear);e&&this.updatePoint(e)},t.prototype.updatePoint=function(t){t!==this.currentPointId&&(this.currentPointId&&(this._markers.forEach((function(t){t.marker.remove()})),this._markers=[]),this.currentPointId=t,t&&this._addPoint(t))},t.prototype.updateActiveMarker=function(t){this._markers.forEach((function(e){e.properties.year===t.year&&e.properties.numb===t.numb?e.element.classList.add("active"):e.element.classList.remove("active")}))},t.prototype._getPointIdByYear=function(t){var e=this._getPointByYear(t);if(e)return e&&String(e.id)},t.prototype._addPoint=function(t){var e=this;Object(o.a)(t).then((function(t){var n=t.features.length>1&&t.features.map((function(t){return t.properties.numb})).filter(a.c),r=n&&n.length>1;t.features.forEach((function(t,n){var i=t&&t.geometry&&t.geometry.type;"MultiPoint"===i?t.geometry.coordinates.forEach((function(n){e._addMarkerToMap(n,t.properties,r)})):"Point"===i&&e._addMarkerToMap(t.geometry.coordinates,t.properties,r)}))}))},t.prototype._addMarkerToMap=function(t,e,n){var a=this,o=this.app.webMap.mapAdapter.map;if(o){var p=document.createElement("div"),s=void 0;if(this.app.controls.yearsStatPanelControl){var c=this.app.controls.yearsStatPanelControl.yearStat;s=c&&c.year===e.year&&c.numb===e.numb}p.className="map-marker"+(s?" active":"");var u=document.createElement("div");u.className="map-marker--inner",u.innerHTML=n?'<div class="map-marker__label">'+e.numb+"</div>":"",p.appendChild(u);var l=Object(r.a)("EPSG:3857").inverse(t),d=new i.Marker(p),f={marker:d,element:p,properties:e};this._markers.push(f),d.setLngLat(l),d.addTo(o),p.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),a._setMarkerActive(f,e)}))}},t.prototype._setMarkerActive=function(t,e){var n=this.app.controls.yearsStatPanelControl;if(n&&n.yearStats){var r=n.yearStats.find((function(t){return t.year===e.year&&t.numb===e.numb}));r&&(n.updateYearStat(r),n.unBlock(),n.show())}},t.prototype._getPointByYear=function(t){return this._pointsConfig.find((function(e){return e.year===t}))},t.prototype._processPointsMeta=function(t){return t.map((function(t){var e=t.resource,n=e.display_name,r=n.match("(\\d{4})*$");return{name:n,year:r.slice(1).map((function(t){return Number(t)}))[0],id:e.id}}))},t}()},271:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));n(495);var r,i=n(23),a=n(10),o=n(67),p=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.app=e,r.oldNgwMvtApi=!0,r.emitter=new i.EventEmitter,r.events=new a.Events(r.emitter),r.app.webMap.onLoad().then((function(){return r._registerMapboxImages()})),r}return p(e,t),e.prototype.addLayers=function(t,e){return this._createTimeLayers(t,e)},e.prototype._registerMapboxImages=function(){var t=this,e=this.app.webMap.mapAdapter.map;e&&e.loadImage("images/city.png",(function(n,r){e.addImage("city",r),t.emitter.emit("load-images")}))},e.prototype._createTimeLayers=function(t,e){var n=this,r=e;return[this.events.onLoad("load-images").then((function(){return n.app.webMap.addLayer("MVT",{url:t,id:e,paint:{"text-color":"rgba(255, 255, 255, 1)","text-halo-color":"rgba(49, 67, 90, .9)","text-halo-width":1},layout:{"icon-image":"city","icon-allow-overlap":!0,"icon-optional":!0,"text-field":["to-string",["get","toponym"]],"text-anchor":"top","text-size":10,"text-font":["Open Sans Semibold"],"text-variable-anchor":["top"],"text-radial-offset":.95,"text-line-height":1.1,"text-letter-spacing":.06,"text-padding":0,"text-justify":"auto"},type:"icon",nativePaint:!0,sourceLayer:r}).then((function(t){return t}))}))]},e}(o.a)},272:function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var r,i=n(67),a=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.oldNgwMvtApi=!0,e._lineTypes={1:{width:1.06,color:"rgba(132, 73, 58, 1.00)"},2:{width:1.06,color:"rgba(132, 73, 58, 0.50)"},3:{width:2.26,color:"rgba(132, 73, 58, 0.25)"}},e}return a(e,t),e.prototype.addLayers=function(t,e){var n=this.groupLayer?this.groupLayer.opacity:1,r=o({"line-opacity":n,"line-opacity-transition":{duration:0},"line-width":2},this._getLinePaint()),i=e;return[this.app.webMap.addLayer("MVT",{url:t,id:e,paint:r,type:"line",sourceLayer:i,nativePaint:!0,visibility:!0})]},e.prototype._getLinePaint=function(){var t=["match",["get","linetype"]];return Object.entries(this._lineTypes).forEach((function(e){var n=e[0],r=e[1];t.push(Number(n)),t.push(r.color)})),t.push("#000000"),{"line-color":t}},e}(i.a)},283:function(t,e,n){"use strict";n.r(e);n(284),n(285),n(227);var r=n(281),i=n(48),a=n(84),o=n(273),p=n.n(o),s=n(274),c=n.n(s),u=n(275),l=n.n(u),d=n(276),f=n.n(d),h=n(277),m=n.n(h),y=(n(496),new r.a({baseUrl:i.baseUrl,target:"map",timeStops:[{toYear:1462,name:"principalities"}],currentYear:1462,animationDelay:100,animationStep:1,bounds:[2,27,203,82],minZoom:3,periods:p.a,yearsStat:c.a,areaStat:l.a,principalities01:f.a,principalities02:m.a,version:a.version,lineColor:i.lineColor,lineColorLegend:i.lineColorLegend,statusAliases:i.statusAliases}));y.emitter.on("build",(function(){var t=document.getElementsByClassName("noUi-marker-large");t.length&&[t[0],t[t.length-1]].forEach((function(t){t.style.display="none"}))})),window.app=y,window.version=a.version},47:function(t,e,n){"use strict";function r(t){return e=Math.round(t),(n=e.toString().split("."))[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g," "),n.join(".")+" км²";var e,n}function i(t,e,n){return n.indexOf(t)===e}function a(t){var e=document.createElement("textarea");e.innerHTML=t,document.body.appendChild(e),e.focus(),e.select();try{var n=document.execCommand("copy")?"successful":"unsuccessful";console.log("Copying text command was "+n)}catch(t){console.log("Oops, unable to copy")}finally{document.body.removeChild(e)}}n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return a}))},67:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){function t(t,e){this.app=t,this.opacity=1,this.simplification=8,this.oldNgwMvtApi=!1,Object.assign(this,e)}return Object.defineProperty(t.prototype,"groupLayer",{get:function(){return this.app.timeMap&&this.app.timeMap.getTimeGroup(this.name)},enumerable:!0,configurable:!0}),t}()}},[[497,7,10,13,11,8,15,17,9,14,16,12,6,3,1,0,2,4]]]);