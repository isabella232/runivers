(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{268:function(t,e,n){"use strict";n(457);var o=n(22),i=n(104),r=n(245),a=n(266),s=n(267),l=n(249),p=n(108),c=n(60),u=n(252),h=n(253),d=n(254),f=(n(480),n(255)),m=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{l(o.next(t))}catch(t){r(t)}}function s(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((o=o.apply(t,e||[])).next())}))},b=function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},y=function(){function t(t){var e=this;this.app=t,this.isMobile=!1,this._installedControls=[],this._mobileTogglePanels=[],this._openPanels=[],this._eventBindings={onMapClick:function(){return null}},this._mobSizeConst={height:700,width:650},this._togglerEvents=[],this._eventBindings.onMapClick=function(){return e._onMapClick()},this.checkMobile(),this.initControls(),this._updateTimeSlider(),this._updateMapEvents(),this._addEventsListeners()}return t.prototype.updateControls=function(){var t=this;this.removeControls();var e=this.app.webMap.getContainer();e&&(this.isMobile?(this._hideAllPanels(),e.classList.add("mobile"),this._addMobileControls(),this._addPanelToggleListeners()):(this._mobileTogglePanels.forEach((function(e){-1!==t._openPanels.indexOf(e)&&e.show()})),this._removePanelToggleListener(),e.classList.remove("mobile"),this._addFullSizeControls()))},t.prototype.removeControls=function(){var t=this;this._installedControls.forEach((function(e){t.app.webMap.removeControl(e)})),this._installedControls=[]},t.prototype.initControls=function(){return m(this,void 0,void 0,(function(){var t=this;return b(this,(function(e){return this.periodsPanelControl=new h.a({webMap:this.app.webMap}),this.yearsStatPanelControl=new d.a({webMap:this.app.webMap}),this.legendPanel=new u.a({colors:this.app.options.lineColorLegend}),this.legendPanel.emitter.on("change",(function(e){return t.app.updateLayersColor()})),this._socialLinksPanel=Object(c.d)(),this._switchersPanel=Object(c.e)(this),this._homeBtnPanel=Object(c.c)(this),this._zoomControl=this.app.webMap.getControl("ZOOM",{zoomInTitle:"Приблизить",zoomOutTitle:"Отдалить"}),this._attributions=this.app.webMap.getControl("ATTRIBUTION"),this._mobileTogglePanels=[this.periodsPanelControl,this.yearsStatPanelControl,this.legendPanel],this._mobileTogglePanels.forEach((function(t){return t.show()})),this._loadingControl=new f.a(this.app.timeMap),[2]}))}))},t.prototype._addControl=function(t,e,n){return m(this,void 0,void 0,(function(){var o;return b(this,(function(i){switch(i.label){case 0:return[4,this.app.webMap.addControl(t,e,n)];case 1:return(o=i.sent())&&this._installedControls.push(o),[2]}}))}))},t.prototype._addFullSizeControls=function(){return m(this,void 0,void 0,(function(){return b(this,(function(t){switch(t.label){case 0:return[4,this._addControl(this.legendPanel,"top-left")];case 1:return t.sent(),[4,this._addControl(this._switchersPanel,"top-right")];case 2:return t.sent(),[4,this._addControl(this.periodsPanelControl,"top-right")];case 3:return t.sent(),[4,this._addControl(this.yearsStatPanelControl,"top-right")];case 4:return t.sent(),[4,this._addControl(this._attributions,"bottom-left")];case 5:return t.sent(),[4,this._addControl(this._socialLinksPanel,"bottom-left")];case 6:return t.sent(),[4,this._addControl(this._homeBtnPanel,"bottom-left")];case 7:return t.sent(),[4,this._addControl(this._zoomControl,"bottom-left")];case 8:return t.sent(),this._manualControlMove(),[2]}}))}))},t.prototype._addMobileControls=function(){return m(this,void 0,void 0,(function(){return b(this,(function(t){switch(t.label){case 0:return[4,this._addControl(this._loadingControl,"top-right")];case 1:return t.sent(),[4,this._addControl(this._switchersPanel,"top-left")];case 2:return t.sent(),[4,this._addControl(this.legendPanel,"bottom-right")];case 3:return t.sent(),[4,this._addControl(this.yearsStatPanelControl,"bottom-right")];case 4:return t.sent(),[4,this._addControl(this.periodsPanelControl,"bottom-right")];case 5:return t.sent(),[4,this._addControl(this._zoomControl,"top-left")];case 6:return t.sent(),[4,this._addControl(this._homeBtnPanel,"top-left")];case 7:return t.sent(),[4,this._addControl(this._attributions,"bottom-left")];case 8:return t.sent(),[4,this._addControl(this._socialLinksPanel,"bottom-left")];case 9:return t.sent(),this._manualControlMove(),[2]}}))}))},t.prototype._manualControlMove=function(){var t=this.app.webMap.getContainer();if(t){var e=t.querySelector(".mapboxgl-ctrl.mapboxgl-ctrl-attrib");e&&e.parentNode&&(e.parentNode.removeChild(e),t.appendChild(e))}},t.prototype.checkMobile=function(){return this.isMobile=window.innerWidth<=this._mobSizeConst.width||window.innerHeight<=this._mobSizeConst.height,this.isMobile},t.prototype._updateMapEvents=function(){this.isMobile?this._addMapClickEvent():this._removeMapClickEvent()},t.prototype._updateTimeSlider=function(){var t=document.querySelectorAll(".noUi-marker.noUi-marker-horizontal.noUi-marker-normal"),e=Array.from(t),n=document.querySelectorAll(".noUi-value.noUi-value-horizontal.noUi-value-large");e=e.concat([n[1],n[n.length-2]]),window.innerWidth<=this._mobSizeConst.width?e.forEach((function(t){t.style.visibility="hidden"})):e.forEach((function(t){t.style.visibility=""}))},t.prototype._onPanelToggle=function(t){this._removePanelToggleListener();var e=t.isHide;this._hideAllPanels(),e||t.show(),this._addPanelToggleListeners()},t.prototype._addPanelToggleListeners=function(){var t=this;this._removePanelToggleListener(),this._togglerEvents=[],this._mobileTogglePanels.forEach((function(e){var n=function(){return t._onPanelToggle(e)};t._togglerEvents.push([e,n]),e.emitter.on("toggle",n)}))},t.prototype._removePanelToggleListener=function(){var t=this;this._mobileTogglePanels.forEach((function(e){var n=t._togglerEvents.find((function(t){return t[0]===e}));n&&e.emitter.removeListener("toggle",n[1])}))},t.prototype._onMapClick=function(){this.isMobile&&this._hideAllPanels()},t.prototype._onWindowResize=function(){var t=this.isMobile;this.checkMobile(),t!==this.isMobile&&this.updateControls(),this._updateTimeSlider(),this._updateMapEvents()},t.prototype._addEventsListeners=function(){var t=this;window.addEventListener("resize",(function(){return t._onWindowResize()}),!1)},t.prototype._hideAllPanels=function(){var t=this;this._openPanels=[],this._mobileTogglePanels.forEach((function(e){e.isHide||t._openPanels.push(e),e.hide()}))},t.prototype._addMapClickEvent=function(){this.app.webMap.emitter.on("click",this._eventBindings.onMapClick)},t.prototype._removeMapClickEvent=function(){this.app.webMap.emitter.removeListener("click",this._eventBindings.onMapClick)},t}(),_=n(269),g=n(142),v=n(257),w=n(258),C=n(259),M=n(270);n.d(e,"a",(function(){return Y}));var P=function(){return(P=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},k=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{l(o.next(t))}catch(t){r(t)}}function s(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((o=o.apply(t,e||[])).next())}))},S=function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},Y=function(){function t(t){var e=this;this.options={target:"#app",style:{transition:{duration:0,delay:0},glyphs:location.origin+location.pathname+"font/{fontstack}/{range}.pbf"}},this.urlParams=g.a,this.emitter=new o.EventEmitter,this.statusLayers={base:M.a,cities:w.a,lines:C.a},this.options=P(P({},this.options),t),this._markers=new v.a(this);var n=this.urlParams.get("year");n&&(this.options.currentYear=parseInt(n,10));var i=this.options,r=i.fromYear,a=i.currentYear;r&&a&&a<r&&(this.options.currentYear=r),this.createWebMap().then((function(){e._buildApp()}))}return t.prototype.createWebMap=function(){return k(this,void 0,void 0,(function(){var t,e,n=this;return S(this,(function(o){switch(o.label){case 0:return t=P({},this.options),[4,(e=new i.default({mapAdapter:new a.a,starterKits:[new r.default]})).create(t)];case 1:return o.sent(),this.timeMap=new _.a(e,{fromYear:this.options.fromYear,getStatusLayer:function(t){return n._getStatusLayer(t)},onStepReady:function(t){return n.updateDataByYear(t)},onLayerUpdate:function(t){return n.updateDataByYear(t)}}),this.timeMap.emitter.once("loading:finish",(function(){n._setSelectedLayerFromUrl()})),this.options.currentYear&&(this.timeMap.currentYear=this.options.currentYear),e.addBaseLayer("QMS",{id:"baselayer",qmsId:2550,visibility:!0}),this.webMap=e,[2,e]}}))}))},t.prototype.updateDataByYear=function(t){var e=this._markers._getPointIdByYear(t);this._markers.updatePoint(e);var n=this._findAreaStatByYear(t);this._updatePeriodBlockByYear(t,n),this._updateYearStatBlockByYear(t,n),this.urlParams.set("year",String(t))},t.prototype.getTimeStop=function(t){var e=this.options.timeStops.find((function(e){return t<e.toYear}));return e?e.name:""},t.prototype.updateLayersColor=function(){},t.prototype._setSelectedLayerFromUrl=function(){var t=g.a.get("id");if(t){var e=this.timeMap.getTimeGroup("base");e&&e.select(t)}},t.prototype._buildApp=function(){var t=this;Object(l.a)((function(e){t.timeMap.buildTimeMap(e),t.slider=t._createSlider(),t._createHeader(),t._createAffiliatedLogos(),t.controls=new y(t),t.controls.updateControls(),t.webMap.onMapLoad((function(){t.timeMap.updateByYear(t.timeMap.currentYear)})),t.emitter.emit("build"),t._addEventsListeners()})),Object(p.b)().then((function(e){t._markers.setPoints(e)}))},t.prototype._getStatusLayer=function(t){var e={name:t.name,baseUrl:this.options.baseUrl,manualOpacity:!0,filterIdField:"fid"},n=this.statusLayers[t.name];if(n)return new n(this,e)},t.prototype._createSlider=function(){var t=this,e=new s.a({type:"range",min:this.timeMap._minYear,max:this.timeMap._maxYear,step:1,animationStep:this.options.animationStep||1,value:this.timeMap.currentYear,animationDelay:this.options.animationDelay||100,stepReady:function(e,n,o){t.timeMap._stepReady(e,n,o)}});e.emitter.on("change",(function(e){e!==t.timeMap.currentYear&&(t.timeMap.currentYear=e,t.timeMap.updateByYear(e))}));var n=this.webMap.mapAdapter.getContainer();return n&&n.appendChild(e.onAdd(this.webMap)),e},t.prototype._createHeader=function(){var t=document.createElement("div");t.className="font-effect-shadow-multiple app-header";var e=document.createElement("span");e.innerHTML="\n      Границы России "+this.timeMap._minYear+"-"+this.timeMap._maxYear+" гг.",t.appendChild(e),t.appendChild(Object(c.a)(this));var n=this.webMap.mapAdapter.getContainer();return n&&n.appendChild(t),t},t.prototype._createAffiliatedLogos=function(){var t=document.createElement("div");t.className="app-affiliated-logos",t.appendChild(Object(c.b)(this));var e=this.webMap.mapAdapter.getContainer();return e&&e.appendChild(t),t},t.prototype._updatePeriodBlockByYear=function(t,e){var n=this._findPeriodByYear(t);n&&this.controls.periodsPanelControl&&this.controls.periodsPanelControl.updatePeriod(n,e)},t.prototype._findPeriodByYear=function(t){return(this.options.periods||[]).find((function(e){var n=t>=e.years_from;return n&&e.years_to&&(n=t<=e.years_to),n}))},t.prototype._updateYearStatBlockByYear=function(t,e){if(this.controls.yearsStatPanelControl){var n=this._findYearStatsByYear(t);this.controls.yearsStatPanelControl.updateYearStats(n,e)}},t.prototype._findAreaStatByYear=function(t){if(this.options.areaStat)return this.options.areaStat.find((function(e){return e.year===t}))},t.prototype._findYearStatsByYear=function(t){return t=Number(t),(this.options.yearsStat||[]).filter((function(e){return t===e.year}))},t.prototype._addEventsListeners=function(){var t=this;this.controls.yearsStatPanelControl&&this.controls.yearsStatPanelControl.emitter.on("update",(function(e){var n=e.yearStat;t._markers.updateActiveMarker(n)}))},t}()},457:function(t,e,n){},480:function(t,e,n){},83:function(t){t.exports=JSON.parse('{"name":"russia-history","version":"3.2.0","description":"","main":"src/app.js","scripts":{"start":"webpack-dev-server --progress --hot --open","build":"webpack --progress","watch":"rimraf ./dist && npm run build -- --watch","dev":"rimraf ./dist && npm run build","data":"node ./scripts/generator.js","prod":"rimraf ./dist && npm run build -- --mode=production"},"author":"","license":"ISC","dependencies":{"@nextgis/dialog":"^0.22.0","@nextgis/mapboxgl-map-adapter":"^0.22.0","@nextgis/ngw-connector":"^0.22.0","@nextgis/qms-kit":"^0.22.0","@nextgis/url-runtime-params":"^0.22.0","@nextgis/webmap":"^0.22.0","@types/color":"^3.0.0","@types/node":"^13.1.0","@types/proj4":"^2.5.0","color":"^3.1.2","core-js":"^3.6.1","dialog-polyfill":"^0.5.0","mapbox-gl":"^1.6.1","nouislider":"14.1.1","proj4":"^2.6.0","regenerator":"^0.14.2","reset-css":"^5.0.1","wnumb":"^1.2.0"},"devDependencies":{"@nextgis/eslint-config":"^0.22.0","@types/geojson":"^7946.0.7","@types/mapbox-gl":"^1.6.1","@types/nouislider":"^9.0.5","autoprefixer":"^9.7.3","babel-loader":"^8.0.6","copy-webpack-plugin":"^5.1.1","css-loader":"^3.4.0","csv-loader":"^3.0.2","eslint":"^6.8.0","eslint-loader":"^3.0.3","favicons-webpack-plugin":"1.0.2","file-loader":"^5.0.2","fork-ts-checker-webpack-plugin":"^3.1.1","html-webpack-plugin":"^3.2.0","image-webpack-loader":"^6.0.0","mini-css-extract-plugin":"^0.9.0","node-sass":"^4.13.0","papaparse":"^5.1.1","postcss-loader":"^3.0.0","precss":"^4.0.0","sass-loader":"^8.0.0","style-loader":"^1.1.2","ts-loader":"^6.2.1","typescript":"^3.7.4","url-loader":"^3.0.0","webpack":"^4.41.4","webpack-cli":"^3.3.10","webpack-dev-server":"^3.10.1"}}')}}]);